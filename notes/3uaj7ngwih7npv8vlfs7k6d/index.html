<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/cs/favicon.ico"/><title>Thread Safety</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="Thread Safety"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://chinootes.github.io/cs/notes/3uaj7ngwih7npv8vlfs7k6d/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="4/14/2024"/><meta property="article:modified_time" content="5/7/2024"/><link rel="canonical" href="https://chinootes.github.io/cs/notes/3uaj7ngwih7npv8vlfs7k6d/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/cs/_next/static/css/896e35ac335ee88a.css" as="style"/><link rel="stylesheet" href="/cs/_next/static/css/896e35ac335ee88a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/cs/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/cs/_next/static/chunks/webpack-114d62680617a3fa.js" defer=""></script><script src="/cs/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/cs/_next/static/chunks/main-909e1e4186772aeb.js" defer=""></script><script src="/cs/_next/static/chunks/pages/_app-13bb43f56c9a0d26.js" defer=""></script><script src="/cs/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/cs/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/cs/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/cs/_next/static/OQElCxbN_7VOTny6p9vJQ/_buildManifest.js" defer=""></script><script src="/cs/_next/static/OQElCxbN_7VOTny6p9vJQ/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="thread-safety">Thread Safety<a aria-hidden="true" class="anchor-heading icon-link" href="#thread-safety"></a></h1>
<p>How to make a block of code thread safe?</p>
<p>In addition to the usual ways to ensure <a href="/cs/notes/5mqyhqbl70k784qyd7mrkav">Thread Safety</a>, Java provides some additional <a href="/cs/notes/3fnxobrsrcrbd4j3v6fz4wz">Synchronization</a> mechanisms:</p>
<ol>
<li>
<p>Thread local fields</p>
<p>Defining private fields in Thread classes</p>
<ul>
<li>
<p>Assigning ThreadLocal instances to a field</p>
<p>  Like normal class fields but each thread accesses them via a setter-getter and gets independently initialized copy of the field so that each thread has its own state</p>
</li>
</ul>
</li>
<li>
<p>Synchronized Collections</p>
</li>
<li>
<p>Concurrent Collections</p>
<p>Concurrent collections achieve thread safety by dividing their data into segments and acquiring locks on different segments.</p>
<p>Better performance</p>
</li>
<li>
<p>Atomic objects</p>
</li>
<li>
<p>Synchronized Methods</p>
</li>
<li>
<p>Synchronized statements</p>
</li>
<li>
<p>Other objects as lock</p>
</li>
<li>
<p>Volatile fields</p>
</li>
<li>
<p>Reentrant locks</p>
</li>
<li>
<p>Read/write locks</p>
</li>
</ol>
<h3 id="volatile-and-atomic">Volatile and Atomic<a aria-hidden="true" class="anchor-heading icon-link" href="#volatile-and-atomic"></a></h3>
<p><code>volatile</code> is used when there are two threads store and perform operations on same variable. In such case, both threads store the variable in different caches. This results in inaccuracy and inconsistency. Thus, the <code>volatile</code> keyword lets <a href="/cs/notes/y92rxfv7150ppi7fgius6g3">JVM</a> know that this is variable is going to be changed and it is then stored in the common cache.</p>
<p><code>AtomicInteger</code>, <code>AtomicLong</code> and other such classes are used in a similar situation to above, where the threads are accessing and performing some operation on a variable. If we don't define the variable as Atomic, it might happen that the second thread accesses the variable before the first thread is done performing operation on it. This causes inconsistency in the data. The <code>AtomicInteger</code> makes the integer thread safe by not letting any other thread access until one thread is done.</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#volatile-and-atomic" title="Volatile and Atomic">Volatile and Atomic</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"3uaj7ngwih7npv8vlfs7k6d","title":"Thread Safety","desc":"","updated":1715103679960,"created":1713125526427,"custom":{},"fname":"lang.java.concurrency.multithreading.thread safety","type":"note","vault":{"fsPath":".","selfContained":true,"name":"cs"},"contentHash":"6a84b2182db9d5cf1ea65062b65bc62d","links":[{"type":"wiki","from":{"fname":"lang.java.concurrency.multithreading.thread safety","id":"3uaj7ngwih7npv8vlfs7k6d","vaultName":"cs"},"value":"execution.concurrency.multithreading.thread safety","position":{"start":{"line":4,"column":41,"offset":83},"end":{"line":4,"column":95,"offset":137},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"execution.concurrency.multithreading.thread safety"}},{"type":"wiki","from":{"fname":"lang.java.concurrency.multithreading.thread safety","id":"3uaj7ngwih7npv8vlfs7k6d","vaultName":"cs"},"value":"execution.concurrency.synchronization","position":{"start":{"line":4,"column":127,"offset":169},"end":{"line":4,"column":168,"offset":210},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"execution.concurrency.synchronization"}},{"type":"wiki","from":{"fname":"lang.java.concurrency.multithreading.thread safety","id":"3uaj7ngwih7npv8vlfs7k6d","vaultName":"cs"},"value":"lang.java.jre.jvm","position":{"start":{"line":31,"column":241,"offset":1149},"end":{"line":31,"column":262,"offset":1170},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"lang.java.jre.jvm"}}],"anchors":{"volatile-and-atomic":{"type":"header","text":"Volatile and Atomic","value":"volatile-and-atomic","line":35,"column":0,"depth":3}},"children":[],"parent":"jik03wh5g5jxxfz2aklbmub","data":{}},"body":"\u003ch1 id=\"thread-safety\"\u003eThread Safety\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#thread-safety\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eHow to make a block of code thread safe?\u003c/p\u003e\n\u003cp\u003eIn addition to the usual ways to ensure \u003ca href=\"/cs/notes/5mqyhqbl70k784qyd7mrkav\"\u003eThread Safety\u003c/a\u003e, Java provides some additional \u003ca href=\"/cs/notes/3fnxobrsrcrbd4j3v6fz4wz\"\u003eSynchronization\u003c/a\u003e mechanisms:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eThread local fields\u003c/p\u003e\n\u003cp\u003eDefining private fields in Thread classes\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAssigning ThreadLocal instances to a field\u003c/p\u003e\n\u003cp\u003e  Like normal class fields but each thread accesses them via a setter-getter and gets independently initialized copy of the field so that each thread has its own state\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSynchronized Collections\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eConcurrent Collections\u003c/p\u003e\n\u003cp\u003eConcurrent collections achieve thread safety by dividing their data into segments and acquiring locks on different segments.\u003c/p\u003e\n\u003cp\u003eBetter performance\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAtomic objects\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSynchronized Methods\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSynchronized statements\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOther objects as lock\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eVolatile fields\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eReentrant locks\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRead/write locks\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"volatile-and-atomic\"\u003eVolatile and Atomic\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#volatile-and-atomic\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003evolatile\u003c/code\u003e is used when there are two threads store and perform operations on same variable. In such case, both threads store the variable in different caches. This results in inaccuracy and inconsistency. Thus, the \u003ccode\u003evolatile\u003c/code\u003e keyword lets \u003ca href=\"/cs/notes/y92rxfv7150ppi7fgius6g3\"\u003eJVM\u003c/a\u003e know that this is variable is going to be changed and it is then stored in the common cache.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAtomicInteger\u003c/code\u003e, \u003ccode\u003eAtomicLong\u003c/code\u003e and other such classes are used in a similar situation to above, where the threads are accessing and performing some operation on a variable. If we don't define the variable as Atomic, it might happen that the second thread accesses the variable before the first thread is done performing operation on it. This causes inconsistency in the data. The \u003ccode\u003eAtomicInteger\u003c/code\u003e makes the integer thread safe by not letting any other thread access until one thread is done.\u003c/p\u003e","noteIndex":{"id":"7ncn3al6mmutkhgoesulce9","title":"Computer Science","desc":"","updated":1715103618849,"created":1713296516553,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"cs"},"contentHash":"36faf26c6be438d4aed355d72b55a110","links":[{"type":"wiki","from":{"fname":"root","id":"7ncn3al6mmutkhgoesulce9","vaultName":"cs"},"value":"arch","position":{"start":{"line":6,"column":3,"offset":105},"end":{"line":6,"column":11,"offset":113},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"arch"}},{"type":"wiki","from":{"fname":"root","id":"7ncn3al6mmutkhgoesulce9","vaultName":"cs"},"value":"paradigm","position":{"start":{"line":11,"column":3,"offset":159},"end":{"line":11,"column":15,"offset":171},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"paradigm"}}],"anchors":{"references":{"type":"header","text":"References","value":"references","line":23,"column":0,"depth":2}},"children":["0xgibr34qhbv1edksyoxakk","e5kuv5gcz6pdxrsakpf7eia","t246wcci6dy9lnof7l1os4l","71sipcgr0pdqyxnmntvx28w","5omh1zinw87le0eyms8g5mk","91er1wb2f5wmbdb5axx5r3r","9z7xt251y1nm9dy2exatukr","u712e7r8bk97hpg9h9j3m4f","xpf86eilma499o4ul566fk8","a1g6tjx0p6bp25v75262gp9","3pr5jo5c742vop6gnoe7c3k","stxoouqpk2rivotuvhjx4yz","g8tiwuotfnbfrbctwyfg8rc","jk63inaclv0ps5i7mktzmm2","5m1yclhdqeshe5szt0masfk","abgag3m7m74vmofvzyyt2fm"],"parent":null,"data":{},"body":"\n\nThese notes are arranged into the below topics:\n\n- AI (Sorry this is on the top, list is alphabetic)\n- [[arch]]\n- Data\n- Execution\n- Languages\n- Semantics\n- [[paradigm]]\n- Philosophy\n- Dev\n- Tools\n- Type Theory\n\n## References\n\n- Hierarchy inpiration - [Map of Computer Science](https://www.flickr.com/photos/95869671@N08/36231833334/in/photostream/lightbox/)"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"dependencies/github.com/chinootes/math","remote":{"type":"git","url":"git@github.com:chinootes/math.git"},"selfContained":true,"name":"math"},{"fsPath":".","selfContained":true,"name":"cs"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://chinootes.github.io","assetsPrefix":"/cs","duplicateNoteBehavior":{"action":"useVault","payload":["math","cs"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"3uaj7ngwih7npv8vlfs7k6d"},"buildId":"OQElCxbN_7VOTny6p9vJQ","assetPrefix":"/cs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>