<h1 id="modules">Modules<a aria-hidden="true" class="anchor-heading icon-link" href="#modules"></a></h1>
<p>Modules in a proper sense emerged in JavaScript with arrival of libraries like CommonJS and Asynchronous Module Definitions (AMD).</p>
<h2 id="commonjs-modules">CommonJS Modules<a aria-hidden="true" class="anchor-heading icon-link" href="#commonjs-modules"></a></h2>
<ul>
<li><code>require()</code> and <code>module.exports</code></li>
<li><a href="/cs/notes/xkbvjycyxxhfp02qwqvyu3q">Asynchronous</a> </li>
</ul>
<h3 id="exporting">Exporting<a aria-hidden="true" class="anchor-heading icon-link" href="#exporting"></a></h3>
<pre class="language-js"><code class="language-js"><span class="token comment">// myModule.js</span>
<span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> greet<span class="token punctuation">;</span>

</code></pre>
<p>For multiple exports</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// myModule.js</span>
exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">greet</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">farewell</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Goodbye, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="importing">Importing<a aria-hidden="true" class="anchor-heading icon-link" href="#importing"></a></h3>
<pre class="language-js"><code class="language-js"><span class="token comment">// main.js</span>
<span class="token keyword">const</span> greet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./myModule.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: Hello, Alice!</span>

<span class="token comment">// Or, if using multiple exports:</span>
<span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./myModule.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>myModule<span class="token punctuation">.</span><span class="token method function property-access">greet</span><span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: Hello, Alice!</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>myModule<span class="token punctuation">.</span><span class="token method function property-access">farewell</span><span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: Goodbye, Alice!</span>


</code></pre>
<h3 id="selectively-loading-modules">Selectively loading modules<a aria-hidden="true" class="anchor-heading icon-link" href="#selectively-loading-modules"></a></h3>
<p>In <a href="/cs/notes/k6j3lplu090syykverllklm">NodeJS</a>, you can load certain parts of modules selectively.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Buffer</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node:buffer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="es6-modules">ES6 Modules<a aria-hidden="true" class="anchor-heading icon-link" href="#es6-modules"></a></h2>
<p>With arrival of <a href="/cs/notes/8b4urrb1hoi023df4vk0z0y">ES6</a>, modules were introduced natively in JS.</p>
<p>The existing <code>require</code> syntax was not used since <code>require</code> is asynchronous.</p>
<h3 id="exporting-1">Exporting<a aria-hidden="true" class="anchor-heading icon-link" href="#exporting-1"></a></h3>
<p>Named exports</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// utils.js</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">multiply</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>
</code></pre>
<p>Default export</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// greeting.js</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="importing-1">Importing<a aria-hidden="true" class="anchor-heading icon-link" href="#importing-1"></a></h3>
<p>Named import </p>
<pre class="language-js"><code class="language-js"><span class="token comment">// main.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> add<span class="token punctuation">,</span> multiply <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./utils.js'</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: 5</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: 6</span>
</code></pre>
<p>Default import</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// main.js</span>
<span class="token keyword module">import</span> <span class="token imports">greet</span> <span class="token keyword module">from</span> <span class="token string">'./greeting.js'</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: Hello, Alice!</span>
</code></pre>
<h3 id="selectively-loading">Selectively loading<a aria-hidden="true" class="anchor-heading icon-link" href="#selectively-loading"></a></h3>
<pre class="language-js"><code class="language-js"><span class="token comment">// main.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> add <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./utils.js'</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Output: 5</span>
</code></pre>
<h2 id="es6-vs-commonjs">Es6 vs CommonJS<a aria-hidden="true" class="anchor-heading icon-link" href="#es6-vs-commonjs"></a></h2>
<h3 id="synchronicity-and-systemscharperformanceithroughput-private"><a href="/cs/notes/bixntxo2partqtrwtco3h6j">Synchronicity</a> and <a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">systems.char.performance.i.throughput (Private)</a><a aria-hidden="true" class="anchor-heading icon-link" href="#synchronicity-and-systemscharperformanceithroughput-private"></a></h3>
<p>Loading is synchronous(step by step) for require on the other hand import can be asynchronous(without waiting for previous import) so it can perform a little better than require.</p>
<h3 id="compatibility">Compatibility<a aria-hidden="true" class="anchor-heading icon-link" href="#compatibility"></a></h3>
<p>ES modules are compatible with Common JS modules. That is, you can import commonJS modules if you're using ES modules.</p>
<p>But you can't import ES modules if you're using CommonJS modules. A workaround is to use <code>import()</code> syntax.</p>
<p>Since the modules are not compatible you have to be careful while shipping your packages. </p>
<h4 id="dual-package-hazard">Dual Package Hazard<a aria-hidden="true" class="anchor-heading icon-link" href="#dual-package-hazard"></a></h4>
<p>Its a situation in which two versions of the same package get loaded within the same runtime environment. Of course, an application or package wouldn't do this intentionally, but it is common that the application itself loads one version, while a dependency of the application loads another version.</p>
<h2 id="which-module-system">Which module system?<a aria-hidden="true" class="anchor-heading icon-link" href="#which-module-system"></a></h2>
<h3 id="default">Default<a aria-hidden="true" class="anchor-heading icon-link" href="#default"></a></h3>
<p>Browsers didn't have module systems early on. Although, <a href="/cs/notes/9fvpxm29occ698gurikidkr">Bundler</a>s can process them. Even today, most modern browsers support only ES modules and have limited support for CommonJS modules.</p>
<p><a href="/cs/notes/k6j3lplu090syykverllklm">NodeJS</a> treats all JS code as CommonJS modules.</p>
<p>Why though? => <strong>Backward Compatibility</strong> </p>
<p>Many existing projects used commonJS modules, since it came first and  nodeJS also traditionally supported CommonJS. Keeping ES as default would mean rewriting or transpiling all that code. Keeping CommonJS as default maintains compatiblity with existing projects.</p>
<p>This allows the developers to gradually adopt the newer spec and stick with CommonJS until the benefits of migration outweigh the compatibility concerns. </p>
<h3 id="configuration">Configuration<a aria-hidden="true" class="anchor-heading icon-link" href="#configuration"></a></h3>
<ul>
<li><strong><a href="/cs/notes/444mthc88lairpwp6u9np27">package.json</a></strong>: <code>"type":"module"</code> indicates that the project uses ES modules.</li>
<li><strong>File extensions</strong> <em>(optional)</em>
<ul>
<li><code>.cjs</code>: CommonJS module (Even in ES module project)</li>
<li><code>.mjs</code>: ES Module (Differentiates ES modules from default <code>.js</code> CommonJS modules)</li>
</ul>
</li>
</ul>
<h3 id="final-outcome-of-bundler">Final Outcome of bundler<a aria-hidden="true" class="anchor-heading icon-link" href="#final-outcome-of-bundler"></a></h3>
<p>Even if you use an ES module system in your project, if your <a href="/cs/notes/9fvpxm29occ698gurikidkr">Bundler</a> emits commonJS code, then you are not really shipping an ES package.</p>
<h3 id="interoperability">Interoperability<a aria-hidden="true" class="anchor-heading icon-link" href="#interoperability"></a></h3>
<p>There are certain workarounds to ensure interoperability of both module systems in your project.</p>
<ol>
<li><a href="/cs/notes/9fvpxm29occ698gurikidkr">Bundler</a>: Bundlers can be configured to handle both modules. It takes care of dependencies and compatibility.</li>
<li>Use <code>import()</code> syntax to import ES modules in CommonJS modules. <code>import</code> statement works the same for ES and CommonJS modules in an ES module.</li>
</ol>
<h2 id="references">References<a aria-hidden="true" class="anchor-heading icon-link" href="#references"></a></h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import">import() - MDN</a></li>
<li><a href="https://github.com/GeoffreyBooth/dual-package-hazard">Dual Package Hazard - GeoffreyBooth/dual-package-hazard - Github</a>: Example illustrating the hazard posed by dual CommonJS/ES module packages</li>
<li><a href="https://www.w3schools.com/js/js_modules.asp">JS Modules - GFG</a></li>
<li><a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">Migrating from CommonJS - Pure ESM package</a></li>
<li><a href="https://youtu.be/6_JNPmjSevo?si=jpqZRov9HMwS7QM0">Import vs Require - The Biggest JavaScript Divide - Matt Pocock - YouTube</a></li>
<li><a href="https://stackoverflow.com/questions/46677752/the-difference-between-requirex-and-import-x">The difference between "require(x)" and "import x"</a></li>
</ul>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/cs/notes/zjy6qb1zy74upea2nw9dzs6">Bun (cs)</a></li>
</ul>